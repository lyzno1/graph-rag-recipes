# GraphRAG 菜谱项目分工协作计划

## 1. 项目现状速览
- **核心流程**沿用 README/技术方案报告中的链路：`数据获取 → 图构建 → 图检索 + 嵌入回退 → LLM 生成 → CLI 展示`，代码集中在 `src/graph_rag_recipes/`。
- **脚本工具链**：`scripts/bootstrap_data.py` 负责下载/解析 HowToCook，`scripts/run_pipeline.py` 调用 `GraphRAGPipeline` 执行推荐；依赖通过 `uv sync` 管理。
- **可扩展点**：`ProjectConfig` 可继续增强，`RecipeGraphBuilder`/`RecipeEmbeddingIndex` 需要针对数据规模提升表现，`LLMGenerator` 目前仅封装 OpenAI Provider，缺少多 Provider 管控与评估记录。

## 2. 工作流拆分
| 工作流 | 目标 & 主要产出 | 涉及模块/脚本 | 关键风险 |
| --- | --- | --- | --- |
| A. 架构统筹与集成 | 统一配置、提升 `GraphRAGPipeline` 可维护性，保障 CLI 流程可复用 | `config.py`、`pipeline.py`、`ui_components.py`、`scripts/run_pipeline.py`、README 与 docs | 配置扩散、缺少一致的运行说明 |
| B. LLM 与语义生成 | 多 Provider 抽象、Prompt 策略、回退策略完善 | `llm_generator.py`、`embeddings.py`（语义接口）、`.env.example`、`scripts/run_pipeline.py` | LLM 依赖不稳定、Prompt 难以复现 |
| C. 数据/图谱与体验 | 数据抓取与清洗、图构建性能、检索兜底、CLI 体验 | `data_ingest.py`、`graph_builder.py`、`retrieval.py`、`scripts/bootstrap_data.py`、`ui_components.py` | 数据波动、图规模导致的性能瓶颈 |

后续所有任务都映射到上面三条主线，以便并行推进、相互解耦。

## 3. 成员分工

### 3.1 刘亦州（技术负责人，统筹 A，并参与 B/C 的关键设计）
- **总体职责**：把关整体架构和代码质量，制定配置规范、Review 代码修改，确保 CLI 流程在课程验收前可稳定运行。
- **核心任务**
  1. **配置与管线治理**：在 `config.py` 中梳理 `ProjectConfig`/`ModelSettings` 的字段使用，整理 `.env.example` 与 README 说明，保证 `GraphRAGPipeline` 初始化只依赖配置注入。
  2. **入口与 UI 统一**：对 `scripts/run_pipeline.py`、`graph_rag_recipes/__init__.py` 以及 `ui_components.py` 进行梳理，确保 CLI 输出一致、可直接复用到后续展示；必要时为 `format_cli_block` 增加调试参数。
  3. **运行验证体系**：总结 `uv sync`、`scripts/bootstrap_data.py`、`scripts/run_pipeline.py` 的标准执行顺序，在 README 及 `docs/技术方案报告.md`/`docs/实现细节报告.md` 中补充“如何验证”章节，形成统一的交付标准。
- **交付提醒**：每个阶段输出评审清单，协调另两位同学的接口变更，必要时提供配置示例或 CLI 输出样例。

### 3.2 张子烨（LLM/语义负责人，对应工作流 B）
- **总体职责**：负责 `LLMGenerator` 的技术选型、Prompt 设计与回退策略，保证生成部分在不同密钥配置下均可稳定降级。
- **核心任务**
  1. **LLM Provider 抽象**：在 `llm_generator.py` 内抽离 Provider 逻辑，扩展 `ProjectConfig.llm_api_key()` 的键值映射，评估 OpenAI/Ollama/GLM 的适配方式，并丰富无密钥场景的模板理由。
  2. **Prompt 与输出质量**：基于现有 `RecipeRecord.as_prompt_chunk()`，为“用户画像输入”“菜名字面输入”整理不同的 Prompt 片段，完善 `LLMGenerator.build_prompt()`，并在 README 的 LLM 配置部分补充样例输出。
  3. **语义观测**：利用 `scripts/run_pipeline.py` 的现有逻辑收集若干固定输入的推荐结果，记录在 `docs/技术方案报告.md` 或 `docs/实现细节报告.md` 的附录，形成 LLM 表现对比素材。
- **协作点**：与刘亦州对齐配置项命名，与杨剑衡同步 `RecipeEmbeddingIndex` 的数据接口（如需要额外的相似度分数供 Prompt 引用）。

### 3.3 杨剑衡（数据 & 图谱 & 体验负责人，对应工作流 C）
- **总体职责**：覆盖 HowToCook 数据生命周期、图/检索性能优化以及 CLI 体验，为 LLM 与管线提供稳定输入。
- **核心任务**
  1. **数据获取与清洗强化**：完善 `scripts/bootstrap_data.py` 的参数校验，结合 `HowToCookIngestor.prepare_local_copy()` 增加失败提示与重试策略，并在 `docs/实现细节报告.md` 增补字段映射与数据更新说明。
  2. **图检索与性能**：优化 `RecipeGraphBuilder` 的建边策略（如按菜系/主料分组减少组合），为 `RecipeRetriever` 增补标签过滤/去重逻辑，评估 `RecipeEmbeddingIndex` 的缓存/降级行为，确保推荐性能与体验。
  3. **CLI 体验**：与 `ui_components.format_cli_block` 协同，丰富输出信息（如展示权重或重叠食材），并在 README 的“使用方式”章节补充截图与运行要点，方便课程展示。
- **协作点**：与张子烨共享语义索引状态，向刘亦州同步数据/图接口变动；遇到大文件或缓存问题需提前更新 `.gitignore`。
